# JSP 태그들

### 쿠키와 세션

- 쿠키는 웹 브라우저의 데이터를 저장하는 기술 중 하나
- 세션은 똑같은 정보를 서버 쪽에 저장하는 역할을 수행함

---

### 세션의 메소드들

- 쿠키보다는 상대적으로 세션의 메소드들이 더 많음

  But, 비활성화된 것들이 더 많아 더 이상 쓸 필요가 없는 것들이 있음.
    
---

- MaxInactiveInterval : 특정 시간 이상 접속 안하면 세션 아이디 제거   
  → 그 설정된 시간이 어느 정도인지 보여주는 역할
    
- ServletContext     
  → 어디서나 데이터를 서블릿 안의 데이터를 가져갈 수 있음
- Invalidate     
  → 로그아웃, 세션 값이 다 사라져버리는 역할을 함
- IsNew      
  → 새로 들어온 세션인지 아닌지 확인하는 역할
- removeAttribute     
  → 세션에 하나 놓은 어트리뷰트를 제거하는 역할      
    
- MaxInactiveInterval      
  → 얼마나 접속했는지를 나타냄, 톰캣이 이를 잡아줌.     
  그래서 톰캣이 허용하는 시간 범위 내에서 이를 잡아줘야 함
    
- SetMaxInactiveInterval 값을 -1이나 0으로 잡으면, 세션 종료 없이 계속 살아있는 개념이 됨.    
  따라서 톰캣에서 세션 타임을 반드시 먼저 체킹해줘야 함.


  `세션 타임을 어디서 체크할 수 있는가?`


- 답변

  > 웹 프로젝트를 만들면 서버가 생김.    
그 서버 안 web.xml이 있음.     
  > 기본적으로 세션 아이디를 포함한 환경설정을 톰캣이 만드는데, session-config에서 session-timeout이 있음.
  디폴트가 30분, 30분 이상일 경우 세션이 끊어짐.    
  보안을 생각하면 무작정 열어놓을 순 없음.
  보통 실무에서 타협을 보는 게 세션 시간 연장을 만들어 놓고, 이제 시간마다 클릭하면 연장할 수 있게끔 해주는 방식을 취함.
  세션 타임을 늘리고 싶으면 web.xml을 손보고 나서  이제 자바에서 MaxInActiveInternal을 손보면 됨.
  spring STS 열어보면, 이 타임아웃 태그가 그대로 있음
      

---

### TimeStamp

  - 데이터베이스 시간 타임 → TIMESTAMP

  - 타임스탬프 값이 출력된 것

  - 타임스탬프는 1970년 1월 1일 기준으로 1초씩 값을 부여한 것


---

### JSP 실행과정

aaa.jsp → aaa_jsp.java (서블릿으로 변환되어 실행) → aap_jsp.class로 변경되어 실행

---

### JSP 태그 5가지

- 주석 태그

    ```html
    <%-- --%>
    ```

    - 주석 비교
        - html : <!-- -->
        - css/javascript //, /* ~ * : 스크립트 선언 안에서 사용
        - 이 주석과 jsp 주석 사이에는 큰 차이가 있음

          →   html, css, javascript는 소스 상태로 웹 브라우저에 온 다음에

          웹 브라우저가 번역한 결과를 보여줌.

          그러나 jsp는 소스가 서버에서 실행되어서 text만 웹 브라우저에 도착함.

          실행되는 시점이 서버고, 다 된 텍스트만 전달됨. 그 안에 html, css, javascript가 포함될 수 있음.

          주석은 실행 시점에서 제거되는데, jsp 주석은 서버에서 지워짐.

          그러나 html, css, javascript의 주석은 지워지지 않은 상태로 웹 브라우저에 도착함.

          **그래서 보안이 요구되는 내용은  html, css, javascript에 절대 작성해서는 안됨.**


---

- 선언 태그
    - 변수와 메소드를 선언하는 선언 태그

        ```html
        <%! int iVar2 = 8; %> <!--혹은-->
        <%! String sayHello(){return “hello”;}> 
        ```

      변수 또는 메소드를 선언할 수 있는 것이 `<%! %>`임

      말 그대로 선언만 가능한 태그임.


---

- 페이지 태그
    - JSP 파일 선언과 파일 전체에 영향을 줌
    - 페이지와 관련된 선언을 하는 태그

    ```html
    <%@ page %>
    <%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8" import="java.util.*, java.awt.*"%>
    ```

  처음 언어, 콘텐츠 타입, 인코딩 방식, 문자 세트 외 자바 라이브러리 import를 할 때 사용하는 태그, 임포트는 1개 외에 두 개 이상도 ,로 병렬로 연결해 사용 가능하다.


---

- 소스 코드 작성 태그
    - 자바를 코딩하는 태그
    - `**<% %>**`
    - Scriptlet 등 굉장히 많은 곳에서 사용된다.

---

- 출력 태그

    ```html
    <%= iVar %> 
    ```

    - iVar가 가진 값을 출력
    - 이 값이 나중에 Expression Language가 됨 (EL) : `${여기에 변수 들어감}`

---

### 선언 태그에서 선언한 변수와 소스 코드 작성 태그에서 선언한 변수의 차이

`전역변수와 지역변수 차이임.`

**전자는 클래스 밖 전역변수 값이고, 후자는 클래스 안 지역변수 값**임.

실제로 서비스 되는 부분이 jspService() 메소드 부분임. 그 반면에 !를 써서 적용하면 멤버 자리(밖에 잡히게 됨)

---

### 태그 작성 시 주의사항

- 주석은 그 안에 쓰는 것이 모두 무시됨. comment, 달고 싶은 내용이 있으면 거기에 설명하면 됨.
    - 예외적으로 주석만 따로 빼 놓고 처리한다고 보면 됨
- **일반 태그와 선언 코드는 세미 콜론이 붙음**
- **출력 태그는 세미 콜론 찍는 순간 에러 → 세미 콜론을 찍지 않음**
- 페이지 태그를 여러 개 해도 에러날 거 없음
- 소스 코드 컴파일된 결과는 계속 남아 있음. jsp를 계속 수정해도 결과가 바뀌지 않는 경우가 있음.

  그래서 C:\apache-tomcat-8.5.84\work\Catalina\localhost\ROOT\org\apache\jsp로 들어가서

  한 번 파일들 삭제해서 날려주고 진행

    - clean tomcat work directory로 같은 역할 가능.
- 변수 이름이 같은데 하나는 멤버변수, 하나는 지역변수
    - 그냥 찍으면 지역변수가 출력됨.

      같은 중괄호 안에 있으므로 변수를 찾을 때 같은 중괄호에 있는 것부터 찾음.

      그 **`지역변수에서 멤버를 찾고 싶으면 this를 사용`**하면 됨.

- **멤버 변수의 자리는 있어도 멤버 메소드 자리는 없음.**

  **대신 메소드 목록 자리가 있음.**

  리턴타입과 argument를 포함한 형태는 가지고 있지만, 그게 생성되는 것은 아님.

  해당 메소드가 호출되면 그제서야 영역을 잡고 메소드가 수행됨.

  그런데 지역변수와 이름이 같은 멤버 변수가 있는데, 이 때 메모리 내 각자 위치한 곳은 다름.

  iVar(같은 변수 이름)를 출력해라 → **이러면, 해당 명령이 있는 위치에서 가져와서 출력**

  **그래서 this.iVar를 출력해라는 명령이 있는 이유(this가 있는 이유)**   
  이 객체의 본체를 찾아가서 iVar를 찾음. 그것이 this의 의미.    
  메소드가 포함된 객체를 포함해야 함.   
  그래서 **멤버변수가 포함된 것을 출력하려면 반드시 this가 있어야 함.**


---

### Scriptlet

- 스크립트 조각내는 것, 원래는 하나의 태그에 있어야 되는 것을 쪼개서 다른 태그 중간에 넣어주는 형식
- 실무에서는 데이터 가져와서 for/반복문 돌릴 때 사용하기 위해 스크립트릿을 사용
- out.print()를 태그로 바꾸면 `<% %>`임

---

### JSP로 데이터 주고 받기

- send_servlet에서 take_servlet으로 데이터를 보낼 수 있고, html 형식으로 보낼 수 있다는 장점이 있음. 파라미터를 통해 클라이언트가 주고 받아 진행할 수 있음.
- 서버로 보내는 데이터는 반드시 이름을 지정해야 함.
- 입력 양식을 하나로 묶은 것을 form이라고 부름
- 데이터를 전송할 곳은 현재 폴더 밑의 값
    - jsp는 폴더 개념으로 감.
- 서블릿은 확장자가 필요하지 않으나, 호출할 때는 확장자를 붙여야 함.
- 이미 jsp에 **내장 객체** : `request, response, session, out`가 있어서 변수로 바로 사용 가능

  jsp 쪽에서 파라미터를 get하는 부분은 request라는 것이 이미 만들어져 있음.

- 서블릿에서 세션을 쓰려고 하려면 미리 `getSession` 작업을 해야 되었는데 그럴 필요가 없음
- 화면에서 보낸 value의 값을 가리키고 있는 이름을 통해서 이 값을 끄집어 낼 수 있음.
- `getParameter` 메소드를 이용해서 값을 가져올 수 있음.

  하나의 데이터(단 건 데이터)를 보내고 있으므로 `getParameter`를 사용하면 됨.

  단건 데이터들은 getParameter로 받으면 되나, 하지만 multiple select box는 안 됨.

  multiple select가 가능하기 때문.

- 복수의 데이터는 `getParameterValues`로 받아서 사용 가능함.

  → 문자 배열로 데이터를 받게 됨. 하나만 출력하게 되는 것이 아니라 배열로 오므로 값을 받아줘야 함.